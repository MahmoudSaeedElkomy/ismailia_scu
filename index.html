<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุงุญุฉ ุงูุนูู: ุฌุงูุนุฉ ููุงุฉ ุงูุณููุณ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Desert Sands & Papyrus with inviting accents -->
    <!-- Application Structure Plan: A multi-scene interactive narrative for marketing. Starts with a hero section, then proceeds through sequential story scenes. Each scene has text, emoji, dynamically changing background colors, and subtle ambient sounds (Tone.js). LLM integration includes an "Inspirational Question" for scene reflection and a "Personalized Welcome Message" at the end of the story. A final call to action section. Controls for background music/ambient sounds. -->
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #FDF8F0;
            color: #4E4234;
            transition: background-color 1.5s ease-in-out; /* Smooth transition for background changes */
        }
        .bg-primary { background-color: #FDF8F0; }
        .bg-secondary { background-color: #F5EFE1; }
        .text-primary { color: #4E4234; }
        .text-accent { color: #8D6B4C; }
        .bg-accent { background-color: #D4A056; }
        .bg-accent-hover:hover { background-color: #C08C3B; }
        .shadow-custom { box-shadow: 0 10px 25px -5px rgba(141, 107, 76, 0.1), 0 4px 6px -4px rgba(141, 107, 76, 0.1); }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #D4A056;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        .mood-ancient { background-color: #D2B48C; } /* Tan/Desert color */
        .mood-oasis-birth { background-color: #A2D9CE; } /* Light teal/greenish blue */
        .mood-strategic { background-color: #ECC8AF; } /* Light peach/gold */
        .mood-transformation { background-color: #ADD8E6; } /* Light blue */
        .mood-resilience { background-color: #FFDAB9; } /* Peach puff / warm tone */
        .mood-academic { background-color: #F0E68C; } /* Khaki / light yellow */
    </style>
</head>
<body class="bg-primary">
    <nav class="sticky top-0 z-50 bg-primary/80 backdrop-blur-md shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-accent">ูุงุญุฉ ุงูุนูู</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4 space-x-reverse">
                        <a href="#story-container" class="text-primary hover:text-accent px-3 py-2 rounded-md text-sm font-medium">ุงููุตุฉ</a>
                        <a href="#student-benefits" class="text-primary hover:text-accent px-3 py-2 rounded-md text-sm font-medium">ููุทูุงุจ ุงููุงูุฏูู</a>
                        <a href="#call-to-action" class="text-primary hover:text-accent px-3 py-2 rounded-md text-sm font-medium">ุงูุถู ุฅูููุง</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <section id="story-container" class="min-h-screen flex flex-col items-center justify-center p-4 py-16 transition-colors duration-1000 ease-in-out mood-ancient">
            <div class="max-w-4xl w-full bg-secondary p-8 rounded-xl shadow-custom text-center">
                <h1 id="story-title" class="text-4xl md:text-5xl font-bold text-accent leading-tight mb-6"></h1>
                <p id="story-text" class="mt-6 text-lg md:text-xl text-primary leading-relaxed"></p>
                <div class="mt-6 text-5xl">
                    <span id="story-icon"></span>
                </div>

                <div id="ai-response-area" class="mt-6 p-4 bg-primary rounded-lg shadow-inner text-primary hidden">
                    <div class="loading-spinner hidden"></div>
                    <p id="ai-response-text" class="leading-relaxed"></p>
                </div>
                
                <div class="mt-8 flex flex-col sm:flex-row items-center justify-center gap-4">
                    <button id="prev-scene-btn" class="bg-accent text-white font-bold py-3 px-8 rounded-full text-lg bg-accent-hover transition-all duration-300 transform hover:scale-105 opacity-50 cursor-not-allowed">
                        ุงููุดูุฏ ุงูุณุงุจู
                    </button>
                    <button id="next-scene-btn" class="bg-accent text-white font-bold py-3 px-8 rounded-full text-lg bg-accent-hover transition-all duration-300 transform hover:scale-105">
                        ุงููุดูุฏ ุงูุชุงูู
                    </button>
                </div>
                <div class="mt-4 text-primary">
                    <span id="current-scene-indicator">1</span> / <span id="total-scenes-indicator"></span>
                </div>
                <div class="mt-6">
                    <button id="inspire-me-btn" class="bg-accent text-white font-bold py-2 px-6 rounded-full text-sm bg-accent-hover transition-all duration-300">
                        ุชุณุงุคู ุฅููุงูู โจ
                    </button>
                </div>
            </div>
        </section>

        <section id="student-benefits" class="py-20 bg-primary">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-3xl font-bold text-accent mb-8">ููุงุฐุง ุชุฎุชุงุฑ ูุงุญุชูุงุ</h2>
                <p class="text-lg text-primary max-w-2xl mx-auto mb-10">ูู ุฌุงูุนุฉ ููุงุฉ ุงูุณููุณุ ูุญู ูุฏุฑู ุฃู ุฑุญูุชู ุงูุชุนููููุฉ ุชุชุฌุงูุฒ ุงููุตูู ุงูุฏุฑุงุณูุฉ. ููุงุ ุณุชุฌุฏ ุจูุฆุฉู ุชุญุชุถูููู ูุชูููุฑู ููู ูููู ูุง ุชุญุชุงุฌููู ููุชุฒุฏูุฑู ุฅูุณุงููุงู ูุฃูุงุฏูููุงู.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="bg-secondary p-6 rounded-xl shadow-custom transform hover:-translate-y-2 transition-transform duration-300">
                        <span class="text-5xl mb-4 block">๐</span>
                        <h3 class="text-xl font-bold text-accent mb-2">ุงูุดุนูุฑ ุจุงูุงูุชูุงุก</h3>
                        <p class="text-primary">ูุฑุญุจุงู ุจู ูู ุฃุณุฑุชูุง! ูุฌุชูุนูุง ุงูุฏุงูุฆ ูุงููุฏูุฏ ูุฌุนูู ุชุดุนุฑ ููุฃูู ูู ุจูุชูุ ุจุนูุฏุงู ุนู ุงูุบุฑุจุฉ.</p>
                    </div>
                    <div class="bg-secondary p-6 rounded-xl shadow-custom transform hover:-translate-y-2 transition-transform duration-300">
                        <span class="text-5xl mb-4 block">๐ก๏ธ</span>
                        <h3 class="text-xl font-bold text-accent mb-2">ุงูุฃูุงู ูุงูุทูุฃูููุฉ</h3>
                        <p class="text-primary">ูุญู ูุนุฏู ุจุจูุฆุฉ ุขููุฉ ููุณุชูุฑุฉุ ุญูุซ ููููู ุงูุชุฑููุฒ ุนูู ุฏุฑุงุณุชู ูุชุฌุงุฑุจู ุฏูู ููู.</p>
                    </div>
                    <div class="bg-secondary p-6 rounded-xl shadow-custom transform hover:-translate-y-2 transition-transform duration-300">
                        <span class="text-5xl mb-4 block">๐</span>
                        <h3 class="text-xl font-bold text-accent mb-2">ุงูุชุฑุญูุจ ูุงูุถูุงูุฉ</h3>
                        <p class="text-primary">ูุฏููุชูุง ูุฌุงูุนุชูุง ุชุนุฑูุงู ููู ุชุจุชุณูุงู ูุชุณุชูุจูุงู ุงูุฒูุงุฑ. ุดุนุงุฑูุง: "ุงุจุชุณู.. ุฃูุช ูู ุญุถุฑุชู!".</p>
                    </div>
                </div>
                <div class="mt-10">
                    <button id="get-welcome-message-btn" class="bg-accent text-white font-bold py-3 px-8 rounded-full text-lg bg-accent-hover transition-all duration-300 transform hover:scale-105">
                        ุงุญุตู ุนูู ุฑุณุงูุฉ ุชุฑุญูุจ ูุฎุตุตุฉ โจ
                    </button>
                    <div id="welcome-message-output" class="mt-6 p-4 bg-secondary rounded-lg shadow-inner text-primary hidden">
                        <div class="loading-spinner hidden"></div>
                        <p></p>
                    </div>
                </div>
            </div>
        </section>

        <section id="call-to-action" class="py-20 bg-secondary text-center">
            <div class="max-w-3xl mx-auto px-4">
                <h2 class="text-3xl font-bold text-accent mb-6">ูุตุชู ุชุจุฏุฃ ููุง!</h2>
                <p class="text-lg text-primary mb-8">ุฌุงูุนุฉ ููุงุฉ ุงูุณููุณ ููุณุช ูุฌุฑุฏ ููุงู ููุฏุฑุงุณุฉุ ุฅููุง ูุงุญุชู ุงูุฌุฏูุฏุฉ ุงูุชู ุณุชููู ูููุง ูุชุฒุฏูุฑ. ุงูุถู ุฅูู ุนุงุฆูุชูุง!</p>
                <a href="#" class="bg-accent text-white font-bold py-3 px-8 rounded-full text-lg bg-accent-hover transition-all duration-300 transform hover:scale-105">
                    ุงูุชุดู ุจุฑุงูุฌูุง ูุณุฌู ุงูุขู
                </a>
            </div>
        </section>
    </main>

    <footer class="bg-primary">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-primary">
            <p>&copy; 2025 ูุงุญุฉ ุงูุนูู: ุฌุงูุนุฉ ููุงุฉ ุงูุณููุณ. ุฌููุน ุงูุญููู ูุญููุธุฉ.</p>
        </div>
    </footer>

    <div class="fixed bottom-4 left-4 bg-secondary p-3 rounded-full shadow-lg flex items-center space-x-2 z-50">
        <button id="toggle-music" class="text-accent text-xl focus:outline-none">
            ๐ถ
        </button>
        <button id="toggle-ambient-sound" class="text-accent text-xl focus:outline-none">
            ๐
        </button>
    </div>

    <script>
        const storyScenes = [
            {
                title: "ูููู ุฑูุญููู ุงูุชุงุฑูุฎู ููููุฏูุชู ููููููุชูู!",
                text: "ุฃูุง ุงูุชู ููููุฏูุชู ููุงุ ุนูู ูุฐู ุงูุฃุฑุถู. ููููู ุนุฏูุฏู ูู ุงูุฃุณูุงุกู.",
                icon: "โณ",
                mood: "mood-ancient"
            },
            {
                title: "ูุงุญุฉู ูู ุฑูุงูู ููุงุกู",
                text: "ูู ุบุงุจุฑ ุงูุชุงุฑูุฎุ ููู ูุญุธุฉู ูุงุ ุชูุงูุช ููุงู ุงูููู ูุน ุจุญูุฑุฉู ููุฑููุฉ. ูุชุดุจุนุช ุฑููุงูููู ุงูุตูุฑุงุก ููุงูุกู ูุงูุญูุง ุนุฐุจูุง! ุซู ูุงุถูุชู ุชูุฑูุจูุชูู ูููู ุงูุซูููุฑุงุชู ุฃูุดูุฌูุงุฑูุงุ ูุงุณุชุญุงูุช ุงูุฃุฑุถูุ ุจุงุชุญุงุฏ ุงูุฃุดุฌุงุฑู ุงููุซูุฑุงุชุ ูุน ูุง ุนุฏุงูุง ูู ุดุฌุฑู ูุซูููุ ุฅูู ูุง ูุดุจู ุงููุงุญุฉ! ูุงู ูููุนู ูุฏูููู ููุฐูููุง! ูููุชู ูู ุงูููุชูู ุชูุงููุงุ ุจูู ุฃุฑุถ ุงูุดุงู ูุฃุฑุถ ูุตุฑ! ุนูู ุงูุญุฏูุฏ ูู ุณููุงุก ุงููุจุงุฑูุฉ!",
                icon: "๐๐ณ",
                mood: "mood-oasis-birth"
            },
            {
                title: "ุจูุงุจุฉู ุงูุญุถุงุฑุงุชู ูููุชูู ุงูุชุฌุงุฑุฉู",
                text: "ูููุชู ูุงูุจูุงุจุฉู ุงูุชู ููููุฑูู ูููุง ูุงุตุฏู ูุฐู ุงูุจูุงุฏุ ุฃู ุชูู! ููุฐููุ ูู ููุธูุฑูุชู ููุงูุ ูุฃูุนูุชู ุงูููุธูุฑูุ ููููุฌูุฏูุชูููู ูู ููููุชูุตููู ุทูุฑููู ุชุฌุงุฑุฉูุ ูุง ุจูู ุจูุญูุฑููููุ ุจููููููููุ ุฃุญูุฑู ูุฃุจูุถู! ูุงู ููููุนูู ูุซุงูููุง! ูู ุงููุงูุนุ ูุงู ุนุจูุฑููุง! ุฃูุง ุตุญุฑุงุกู ูู ุฌูุงุชู ุงูุฃุฑุจุน! ููู ุงูููุชุตู ุชูุงููุงุ ุฃูุง ูุงุญุฉู ููุฑุงุญุฉ! ูู ุงุณุชููุจูููุชู ููุงุฑููุง ูู ููุง! ููุชููุฌูุฑูุง ูุงูุ ุฃู ุนุงุจุฑู ุณุจูููุ ูู ูู ูููู ุงูุฃุฑุถู ูุฑูููุง ูู ููุงุ ุบุงุฒูููุ ุฃู ูุงุชุญูููุ ูู ูู ุงูุตุงูุญููู! ุฃูุง ููุง ููุฐ ุฃุตุจุญ ุงูุชุงุฑูุฎ ุตูุจุญูุง. ูููููููุชูู ูู ุงูุฃุฑุถู. ุฃูุง ูุงุญุฉ! ููููู ุนุฏูุฏู ูู ุงูุฃุณูุงุกู.",
                icon: "๐บ๏ธ๐",
                mood: "mood-strategic"
            },
            {
                title: "ุชุบูุฑุงุชู ุงูุนุตุฑู ูููุงุฉู ุงูุณููุณู",
                text: "ูู ุนุตุฑูู ูุฐุง! ุฏุนุงูู ููููููุง ูู ููููู ูุตุฑ ุจุงุณูู. ููุงุญูุชูููุ ููุตุฏ! ูููุฐ ุฃู ุฏุนุงูู ุจุงุณููุ ุฃุตุจูุญุชู ูุงุญุฉู ููููู ูููู ูููููู ุจูุนูุฏููู. ุฅูุง ุฃูู ูุฏ ุทูุฑูุฃูููู ุจุนุถ ุงูุชุบูุฑ! ุฅุฐ ุญุฌุฒุช ููุงุฉูุ ุดููููุชู ูุง ุจูู ุจูุญูุฑููููุ ุฅูู ุฅุฎุชูุงูู ูู ุทุจูุนุชููู. ูู ุฃุนูุฏ ุฃุฑู ุณููุงุก ุงูุญุจูุจุฉ ููุง ุงุนุชุฏูุช ุฃู ุฃุฑุงูุง ุณุงุจููุง! ุญุชู ููุงูู ุงูุชุฌุงุฑ ุงูุชู ูุงูุช ูุซูุฑูุง ูุง ุชุณุชุฑูุญู ุชุญุชู ุฃุดุฌุงุฑูุ ุงุณุชุจุฏูุชู ุณูููุฉ ุงูุตุญุฑุงุก ุจุณูููุฉู ุฃุฎุฑู ุชุญููู ุจุถุงุฆุนููู ุนูู ุงููุงุก! ูููู ููุช ูุฏ ุจุฏุฃุช ุฃุณุชุญูู ุจุงููุนู ุฅูู ูุฏููุฉูุ ููุฏ ุงุณุชูุฑ ุงููููุงู ุจุจุนุถ ูู ุงูุฃุบุฑุงุจุ ุจูุถู ุงููุฌูู ุดูุฑูุงุ ูู ุฑุญุงุจู. ูุฏูุฑูู ุดุฆูู ุงูููุงุฉู ุงูุชู ุดููููุช ุนูู ูุฌูู! ูุงูุถู ุจุนุถ ุฃูู ูุตุฑ ูู ุงูุฒูุฑููุงุนู ูููุญูู ุชูุฑุจูุชูุ ูููุนุฌุจูุ ุฃูุชุฌุช ุฃุฑุถู ุฃุดูู ุงููุงููุฉ ูุฃุฎุฑุฌุช ุจุญูุฑุงุชู ุฃุดูุฑ ุงูุฃุณูุงู!",
                icon: "๐ข๐๏ธ",
                mood: "mood-transformation"
            },
            {
                title: "ุงูุชุฑุญูุจู ูุงูุตููุฏู: ููููููุชูู",
                text: "ูู ุฃุญุจูู ููููููุชูู! ุฃูุง ุฏูููุง ููุฑูุญูุจู. ุฃุญุจ ุงูุงุจุชุณุงู. ุญุชู ุฅู ุดุนุงุฑู ุงูุฐู ุงุณุชูุจู ุจู ุงูุฒูุงุฑ ูุจุฏุฃ ุจู. ุงุจุชุณู.. ุฃูุช ูู ุญุถุฑุชู! ุซู ุนุงููุชู ูููุงุช ุงูุญุฑูุจุ ูููู ุตูุฏุช! ุจู ุฃูู ุฃุฐูุฑ ูุญุธุฉ ุนุจูุฑู ูุชุงุฆุจ ุงูุฅููุงูุ ุชุณุชุฑุฏ ูุนูููุ ุณููุงุก ุงูุญุจูุจุฉ! ูุญุธุฉ ุฏุญุฑูุง ุงููุนุชุฏู ุงูุบุงุฒู.",
                icon: "๐๐ก๏ธ",
                mood: "mood-resilience"
            },
            {
                title: "ุฌุงูุนุฉู ููุงุฉู ุงูุณููุณ: ููุงุฑุฉู ุงูุนููู",
                text: "ูู ุจุนุฏูุงุ ุจุฏุฃ ุงูุจูุงุก ุนูู ูุตุฑู ุฃุชู. ููุจุชุช ุจุฃุญุดุงุฆู ููุงุฑุฉ ุงูุนูู ุงูุชูุ ุฃูุฎุฑ ุจูุงุ ููุง ุชุบุฑุณู ูู ูุนู! ุฃูุฏู ุฅููููุ ุฌุงูุนุฉ ููุงุฉ ุงูุณููุณ! ููุงุฑุฉ ุงูุนูู.",
                icon: "๐๐ก",
                mood: "mood-academic"
            }
        ];

        let currentSceneIndex = 0;
        const storyContainer = document.getElementById('story-container');
        const storyTitle = document.getElementById('story-title');
        const storyText = document.getElementById('story-text');
        const storyIcon = document.getElementById('story-icon');
        const prevSceneBtn = document.getElementById('prev-scene-btn');
        const nextSceneBtn = document.getElementById('next-scene-btn');
        const currentSceneIndicator = document.getElementById('current-scene-indicator');
        const totalScenesIndicator = document.getElementById('total-scenes-indicator');
        const inspireMeBtn = document.getElementById('inspire-me-btn');
        const aiResponseArea = document.getElementById('ai-response-area');
        const aiResponseText = document.getElementById('ai-response-text');
        const loadingSpinner = aiResponseArea.querySelector('.loading-spinner');
        const getWelcomeMessageBtn = document.getElementById('get-welcome-message-btn');
        const welcomeMessageOutput = document.getElementById('welcome-message-output');
        const welcomeMessageText = welcomeMessageOutput.querySelector('p');
        const welcomeMessageSpinner = welcomeMessageOutput.querySelector('.loading-spinner');

        // Tone.js setup for background music
        let backgroundSynth = new Tone.PolySynth(Tone.Synth, {
            oscillator: { type: "sine" }, // Smooth sine wave for ambient music
            envelope: { attack: 3, decay: 1, sustain: 0.7, release: 5 }
        }).toDestination();
        backgroundSynth.volume.value = -18;

        let musicLoop;
        let isMusicPlaying = false;

        function startMusic() {
            if (!musicLoop) {
                const chords = [
                    ["C4", "E4", "G4"], // C Major
                    ["F4", "A4", "C5"], // F Major
                    ["G4", "B4", "D5"], // G Major
                    ["A3", "C4", "E4"]  // A minor (lower octave for harmony)
                ];
                let chordIndex = 0;
                musicLoop = new Tone.Loop(time => {
                    backgroundSynth.triggerAttackRelease(chords[chordIndex % chords.length], "4n", time); // Longer notes
                    chordIndex++;
                }, "2n").start(0); // Play a chord every 2 beats
            }
            Tone.Transport.start();
            isMusicPlaying = true;
            document.getElementById('toggle-music').textContent = '๐ถ';
        }

        function stopMusic() {
            Tone.Transport.stop();
            Tone.Transport.cancel();
            backgroundSynth.releaseAll();
            musicLoop = null;
            isMusicPlaying = false;
            document.getElementById('toggle-music').textContent = '๐';
        }

        document.getElementById('toggle-music').addEventListener('click', async () => {
            await Tone.start();
            if (isMusicPlaying) {
                stopMusic();
            } else {
                startMusic();
            }
        });

        // Tone.js setup for ambient sound
        let ambientSynth = new Tone.NoiseSynth({
            envelope: {
                attack: 0.05,
                decay: 0.5,
                sustain: 0.5,
                release: 1
            }
        }).toDestination();
        ambientSynth.volume.value = -30; // Very low volume for ambient
        let ambientNoiseLoop;
        let isAmbientSoundPlaying = false;

        function startAmbientSound(type = 'wind') {
            if (!ambientNoiseLoop) {
                ambientNoiseLoop = new Tone.Loop(time => {
                    if (type === 'wind') {
                        ambientSynth.triggerAttackRelease("4n", time, Math.random() * 0.2 + 0.8); // Subtle wind
                    } else if (type === 'water') {
                        ambientSynth.triggerAttackRelease("8n", time, Math.random() * 0.1 + 0.9); // Water ripples
                    } else if (type === 'city') {
                        ambientSynth.triggerAttackRelease("16n", time, Math.random() * 0.05 + 0.95); // Very faint city hum
                    } else if (type === 'birds') {
                         ambientSynth.triggerAttackRelease("16n", time, Math.random() * 0.1 + 0.9);
                    }
                }, "1n").start(0); // Trigger a sound every beat
            }
            Tone.Transport.start();
            isAmbientSoundPlaying = true;
            document.getElementById('toggle-ambient-sound').textContent = '๐';
        }

        function stopAmbientSound() {
            Tone.Transport.stop();
            Tone.Transport.cancel();
            ambientSynth.releaseAll();
            ambientNoiseLoop = null;
            isAmbientSoundPlaying = false;
            document.getElementById('toggle-ambient-sound').textContent = '๐';
        }

        document.getElementById('toggle-ambient-sound').addEventListener('click', async () => {
            await Tone.start();
            if (isAmbientSoundPlaying) {
                stopAmbientSound();
            } else {
                // Default to wind if no specific type is passed
                startAmbientSound('wind');
            }
        });


        // Function to update the scene content and mood
        function updateScene() {
            const scene = storyScenes[currentSceneIndex];
            storyContainer.classList.remove(...Array.from(storyContainer.classList).filter(c => c.startsWith('mood-')));
            storyContainer.classList.add(scene.mood);

            storyTitle.textContent = scene.title;
            storyText.textContent = scene.text;
            storyIcon.textContent = scene.icon;

            // Update navigation buttons
            prevSceneBtn.disabled = currentSceneIndex === 0;
            prevSceneBtn.classList.toggle('opacity-50', currentSceneIndex === 0);
            prevSceneBtn.classList.toggle('cursor-not-allowed', currentSceneIndex === 0);

            nextSceneBtn.disabled = currentSceneIndex === storyScenes.length - 1;
            nextSceneBtn.classList.toggle('opacity-50', currentSceneIndex === storyScenes.length - 1);
            nextSceneBtn.classList.toggle('cursor-not-allowed', currentSceneIndex === storyScenes.length - 1);

            currentSceneIndicator.textContent = currentSceneIndex + 1;
            totalScenesIndicator.textContent = storyScenes.length;

            // Hide AI response area when scene changes
            aiResponseArea.classList.add('hidden');
            aiResponseText.textContent = '';
            welcomeMessageOutput.classList.add('hidden'); // Hide welcome message if visible
            welcomeMessageText.textContent = '';


            // Stop current ambient sound and potentially start a new one based on mood
            if (isAmbientSoundPlaying) {
                stopAmbientSound(); // Stop existing loop first
            }

            // Start new ambient sound based on the scene's mood/content
            if (scene.mood === 'mood-oasis-birth') {
                startAmbientSound('water'); // Gentle water sounds for oasis birth
            } else if (scene.mood === 'mood-strategic') {
                startAmbientSound('wind'); // Wind sounds for trade routes
            } else if (scene.mood === 'mood-transformation') {
                startAmbientSound('city'); // Subtle city hum for modernization
            } else {
                stopAmbientSound(); // No specific ambient sound for other moods
            }
        }

        prevSceneBtn.addEventListener('click', () => {
            if (currentSceneIndex > 0) {
                currentSceneIndex--;
                updateScene();
            }
        });

        nextSceneBtn.addEventListener('click', () => {
            if (currentSceneIndex < storyScenes.length - 1) {
                currentSceneIndex++;
                updateScene();
            }
        });

        // Gemini API calls
        async function callGeminiAPI(prompt, outputElement, spinnerElement) {
            outputElement.classList.remove('hidden');
            outputElement.querySelector('p').textContent = '';
            spinnerElement.classList.remove('hidden');

            const apiKey = "AIzaSyBt3W-fHQ-PPQBTPNlvKrC-XdVt_hz97QI"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    outputElement.querySelector('p').textContent = result.candidates[0].content.parts[0].text;
                } else {
                    outputElement.querySelector('p').textContent = 'ุชุนุฐุฑ ุชูููุฏ ุงูุฑุฏ. ุญุงูู ูุฑุฉ ุฃุฎุฑู.';
                }
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                outputElement.querySelector('p').textContent = 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุงุชุตุงู ุจุงููููุฐุฌ. ุญุงูู ูุฑุฉ ุฃุฎุฑู.';
            } finally {
                spinnerElement.classList.add('hidden');
            }
        }

        inspireMeBtn.addEventListener('click', () => {
            const currentStoryText = storyScenes[currentSceneIndex].text;
            const prompt = `ุจูุงุกู ุนูู ูุฐุง ุงูุฌุฒุก ูู ูุตุฉ ุงููุฏููุฉ: "${currentStoryText}"ุ ุงุณุชุฎุฑุฌ ุณุคุงูุงู ุชุฃูููุงู ุนูููุงู ูููู ุงูุทูุงุจ ุงููุงูุฏูู ููุชูููุฑ ูู ุงูุนูุงูุฉ ุจูู ุงูุชุงุฑูุฎุ ุงููููุฉุ ูุฏูุฑูู ูุฌุฒุก ูู ูุฐู ุงููุตุฉ. ุงุฌุนู ุงูุณุคุงู ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุงููุตุญู ููุจุงุดุฑุฉ.`;
            callGeminiAPI(prompt, aiResponseArea, loadingSpinner);
        });

        getWelcomeMessageBtn.addEventListener('click', () => {
            const prompt = `ุงูุชุจ ุฑุณุงูุฉ ุชุฑุญูุจูุฉ ูุตูุฑุฉ ููููููุฉ ูุทุงูุจ ูุงูุฏ ุฌุฏูุฏ ูู ุฌุงูุนุฉ ููุงุฉ ุงูุณููุณุ ูุณุชูููุงู ูู ุฑูุญ ูุตุฉ ุงููุฏููุฉ (ุงูุฅุณูุงุนูููุฉ) ุงูุชู ุชุชููุฒ ุจุงูุชุฑุญูุจุ ุงูุฃูุงูุ ุงูุชุงุฑูุฎุ ูุงูุนูู (ููุงุฑุฉ ุงูุนูู)ุ ูููู ูููู ููุทุงูุจ ุฃู ูุฌุฏ ูููุง ุงูุงูุชูุงุก ูุงูููู. ุฑูุฒ ุนูู ุงูุฌูุงูุจ ุงูุฅูุณุงููุฉ ูุงูุนูุงุทู. ุงุฌุนู ุงูุฑุณุงูุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุงููุตุญู ุงููุตุญู ูุจุฃุณููุจ ุฏุงูุฆ ููุจุงุดุฑ.`;
            callGeminiAPI(prompt, welcomeMessageOutput, welcomeMessageSpinner);
        });


        // Initial setup
        window.onload = function() {
            updateScene();
            // Start background music by default, user can toggle off
            startMusic(); 
            // Smooth scroll for nav links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({
                        behavior: 'smooth'
                    });
                });
            });
        };
    </script>
</body>
</html>
